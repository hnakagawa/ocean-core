<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>Perl Ocean</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <a class="brand" href="#">Perl Ocean</a>
        <div class="nav-collapse">
          <ul class="nav">
            <li>
              <a href="index.html">Home</a>
            </li>
            <li>
              <a href="installation.html">Getting Started</a>
            </li>
            <li class="active">
              <a href="#">Protocol</a>
            </li>
            <li>
              <a href="development.html">Development</a>
            </li>
            <li>
              <a href="cluster.html">Cluster</a>
            </li>
            <li>
              <a href="media.html">Media Support</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="subnav">
      <ul class="nav nav-tabs">
        <li><a href="protocol.html">概要</a></li>
        <li class="active"><a href="#">サービス</a></li>
        <li><a href="protocolbackground.html">バックグラウンド</a></li>
        <li><a href="protocolscenario.html">ケーススタディ</a></li>
        <li><a href="xep.html">拡張</a></li>
      </ul>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span3">
        <div class="well sidebar-nav">
          <ul class="nav nav-list">
            <li class="nav-header">目次</li>
            <li><a href="#data">データ紹介</a></li>
            <li><a href="#roster">ロスター</a></li>
            <li><a href="#presence">プレゼンス</a></li>
            <li><a href="#message">メッセージ</a></li>
          </ul>
        </div><!--/.well -->
      </div><!--/span-->

      <div class="span9">

        <div class="row-fluid">
          <div class="span12">
            <h2 id="service">どのようなサービスを提供できるか</h2>
            <p>ここでは、XMPPが具体的にどのようなサービスを提供できるプロトコルなのかを紹介していきます。</p>
            <p>おそらくこの文書を読んでいる人の中で、「何らかのインスタントメッセンジャーを使ったことが一度もない」という人はいないと思いますが、インスタントメッセンジャーアプリケーションとは一体どんなものであるかをおさらいしながら、登場するデータや用語を整理していきましょう。</p>

            <p>細かい仕様は後回しにして、まずはクライアントアプリケーションである<b>iChat</b>のビジュアルを通して見ていきましょう。</p>
            <div class="alert alert-block">
              <p>正確には、XMPPというより、XMPPのコア仕様(RFC6120)とその上でメッセージングサービスを提供するためのIM仕様(RFC6121)をあわせた状態で紹介しています。XMPPのコア仕様だけを利用して、IMではないサービスを提供することも可能ですが、むしろそれは高度な利用法といえるでしょう。</p>
              <p>ここでは、理解のしやすさを優先し、コア仕様とIM仕様の区別をせずに説明していきます。</p>
            </div>
          </div>
        </div>

        <div class="row-fluid">
          <div class="span12">
            <h3 id="roster">ロスター</h3>
            <img src="img/protocol/ichat_roster.png">
            <p>サービスにログインすると、まずは上の画像のように、友人情報のリストが表示されます。</p>
            <p>XMPPでは、このような友人情報のリストを<b>ロスター ( roster )</b>と呼びます。直訳すると<b>名簿</b>ですね。<br />
            プロトコルによっては、登録された友人の事をバディーと呼び、そのリストはバディーリストと呼ばれたりします。単純にフレンドリストと呼ばれることもあります。</p>
            <p class="well">このように、XMPPのサービスでは、ログインすると、まずはロスターを同期するところから始まります。</p>
          </div>
        </div>

        <div class="row-fluid">
          <div class="span12">
            <h3 id="presence">プレゼンス</h3>
            <img src="img/protocol/ichat_roster.png"/>

            <p>リストに表示されている情報をよく見てみましょう。</p>
            <p>オフラインの友人の情報がグレーアウトされているのがわかるでしょうか？<br/>
            また、オンラインの友人の情報はくっきりと表示され、名前の左に緑色のライトのアイコンがついています。</p>

            <p>このように、現在のユーザーの状態を表現するデータのことを、<b>プレゼンス</b>と呼びます。<br/>プレゼンスが存在すれば、その友人がオンラインであることがわかります。それだけでなく、<b>チャット可能状態</b>(緑のライト)だとか<b>離席中</b>(赤いライト)だとかを判断することもできます。</p>

            <p>このまま眺めていると、友人がログインしてオフラインからオンラインに切り替わったり、離席してライトが赤くなったりするなど、友人のプレゼンスが変動していくのがわかります。</p>

            <p>当然、自分のプレゼンスも変更できます。</p>

            <img src="img/protocol/ichat_presence_change.png"/>

            <p class="well">このように、友人のリアルタイムのプレゼンスを視認することができますし、自分のプレゼンスをリアルタイムで友人に伝えることが出来ます。
            メッセンジャーというとメッセージにばかり目がいきますが、このように、ロスターやプレゼンスの管理もメッセンジャーサービスを提供する上で重要な要素です。</p>

          </div>
        </div>

        <div class="row-fluid">
          <div class="span12">
            <h3 id="message">メッセージ</h3>
            <img src="img/protocol/ichat_chat_window.png"/>
            <p>友人のリストの中から話しかけたい相手を見つけ、会話を楽しみましょう。</p>

            <p class="well">プレゼンスの存在により、相手がオンラインであることを確認したうえで話かけることが出来ます。<br/>
            それによって、メールとは違ったリアルタイムの会話が楽しめます。</p>
            <div class="alert alert-block">
              <h4 class="alert-heading">注意</h4>
              <p>ここでいう<b>メッセージ</b>とは、画像のイメージのとおり、いわゆる<b>チャットテキスト</b>の事になります。プロトコルによっては、いわゆるパケットやフレームのように、サーバーやクライアントのようなノード間で転送されるデータの一単位の塊のことを<b>メッセージ</b>と呼ぶことがあります。</p>
              <p>特にXMPPは、そのデータ配送の性質から、<b>AMQP</b>というプロトコルと並べて語られることがあります。<b>AMQP</b>はメッセージキューのための仕様を定めるもので、そこで言う<b>メッセージ</b>とは、<b>パケット</b>のような意味合いになり、<b>チャットテキスト</b>の意味ではありません。</p>
              <p><b>メッセージ</b>とは、XMPPプロトコルのコンテキストにおいては<b>チャットテキスト</b>、メッセージキューなどのコンテキストにおいては<b>パケット</b>という意味合いになることを理解し、混乱しないように気をつけましょう。</p>
              <p>Oceanでサポートしているクラスターシステムでは、メッセージキューの利用を前提としています。<a href="cluster.html">クラスターガイド</a>にて詳しく解説します。</p>
            </div>
          </div>
        </div>


        <div class="row-fluid">
          <div class="span12">
            <h3 id="subscription">サブスクリプション - 名簿の管理</h3>

            <img src="img/protocol/ichat_subscription.png"/>

            <p>上で友人情報がいくつかすでに存在しているロスタの画像を表示しましたが、当然ながら最初から友人情報が埋まっているわけではなく、友人情報の新規登録や削除の機能がサポートされている必要があります。</p>

            <p>ロスタに存在する友人との関係を管理するのが<b>サブスクリプション ( subscription )</b>です。日本語だと<b>購読</b>と訳されることが多いようですが、現在ならTwitterでいうところの<b>フォロー</b>と言ったほうがわかりやすいかもしれません。ですので、ここでは<b>"subscribe"</b>を<b>「購読する」</b>ではなく、<b>「フォローする」</b>と表現しながら話をすすめることにします。</p>

            <p>次のような機能がサポートされています。

            <ul>
              <li>フォロー申請する</li> 
              <li>フォロー申請を許可する</li>
              <li>フォロー申請を拒否する</li>
              <li>フォローをやめる</li>
            </ul>
            </p>


            <p>相手との関係性を表すために、次の種類の<b>サブスクリプションタイプ</b>があります。</p>
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th class="blue header">種類</th>
                  <th class="blue header">概要</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>TO</td><td>その相手を一方的にフォローしている。そのユーザーのプレゼンスが変更されたら通知される。</td></tr>
                <tr><td>FROM</td><td>その相手から一方的にフォローされている。自分のプレゼンスが変更されたら相手に通知される。</td></tr>
                <tr><td>BOTH</td><td>お互いにフォローしあっている。それぞれのプレゼンスが変更されたら、相手に通知される。</td></tr>
                <tr><td>NONE</td><td>フォローはお互いにしてない。</td></tr>
              </tbody>
            </table>

        <hr/>

        <div class="row-fluid">
          <div class="span12">
            <p>XMPPでどのようなサービスが提供できるのか、クライアントアプリケーションを通して確認し、どのようなデータが扱われているのかを把握できました。</p>
            <p>次は、このようなGUIアプリケーションの裏で、実際にクライアントとサーバーがどのようなやりとりをしているのかを見ていきます。</p>
            <p><a href="protocolbackground.html" class="btn btn-primary btn-large">XMPP IMサービスのバックグラウンド &raquo;</a></p>
          </div><!--/span-->
        </div><!--/row-->

      </div>
    </div>

    <hr />
    <footer>
      <p>&copy; Lyo Kato 2012</p>
    </footer>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

</body>
</html>
